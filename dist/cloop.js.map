{"version":3,"sources":["onFrame.js","Looper.js","singleton.js","cloop.js"],"names":["lastTime","vendors","glob","window","raf","requestAnimationFrame","caf","cancelAnimationFrame","i","length","now","Date","getTime","onFrame","cb","id","frame","Promise","bind","callback","currTime","timeToCall","Math","max","setTimeout","clearTimeout","Looper","_handlers","_now","_last","_hasSetNextFrame","_cancelNextFrame","loop","nextFrame","_instance","delta","handler","push","removeHandler","filter","h","clearNextFrame","instance","addHandler"],"mappings":"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","file":"cloop.js","sourceRoot":"../src","sourcesContent":["// Adapted from the Paul Irish gist at https://gist.github.com/paulirish/1579671\n// MIT license\nvar lastTime = 0\nvar vendors = ['ms', 'moz', 'webkit', 'o']\nvar glob = typeof window === 'undefined' ? {} : window\nvar raf = glob.requestAnimationFrame\nvar caf = glob.cancelAnimationFrame\n\nfor (var i = 0; i < vendors.length && (!raf || !caf); i++) {\n  raf = glob[vendors[i] + 'RequestAnimationFrame']\n  caf = glob[vendors[i] + 'CancelAnimationFrame'] || glob[vendors[i] + 'CancelRequestAnimationFrame']\n}\n\nexport var now = Date.now || function () { return new Date().getTime() }\n\nif (!raf || !caf) {\n  raf = function (callback) {\n    var currTime = now()\n    var timeToCall = Math.max(0, 16 - (currTime - lastTime))\n    lastTime = currTime + timeToCall\n    return setTimeout(\n      function () { callback(lastTime) },\n      timeToCall\n    )\n  }\n\n  caf = function (id) { clearTimeout(id) }\n} else {\n  raf = raf.bind(glob)\n  caf = caf.bind(glob)\n}\n\nexport function onFrame (cb) {\n  var id = raf(cb)\n  return function () { caf(id) }\n}\n\nexport async function frame () {\n  return new Promise(onFrame)\n}\n","import { onFrame, now } from './onFrame'\n\nexport class Looper {\n  static get instance () {\n    if (!this._instance) this._instance = new Looper()\n    return this._instance\n  }\n\n  constructor () {\n    this._handlers = []\n    this._now = this._last\n    this._hasSetNextFrame = false\n    this._cancelNextFrame = null\n    this.loop = this.loop.bind(this)\n    this.nextFrame()\n  }\n\n  loop () {\n    this._now = now()\n    var delta = this._now - (this._last || this._now)\n    for (var i = 0; i < this._handlers.length; i++) {\n      this._handlers[i](delta)\n    }\n    this._last = this._now\n    this._hasSetNextFrame = false\n    this.nextFrame()\n  }\n\n  nextFrame () {\n    if (this._handlers.length && this._hasSetNextFrame === false) {\n      this._hasSetNextFrame = true\n      this._cancelNextFrame = onFrame(this.loop)\n    }\n  }\n\n  clearNextFrame () {\n    this._cancelNextFrame && this._cancelNextFrame()\n    this._cancelNextFrame = null\n    this._hasSetNextFrame = false\n  }\n\n  addHandler (handler) {\n    this._handlers.push(handler)\n    this.nextFrame()\n    return this.removeHandler.bind(this, handler)\n  }\n\n  removeHandler (handler) {\n    this._handlers = this._handlers.filter(function (h) { return h !== handler })\n    if (this._handlers.length === 0) {\n      this._last = null\n      this.clearNextFrame()\n    }\n  }\n}\n","import { Looper } from './Looper'\n\nexport function loop (cb) {\n  return Looper.instance.addHandler(cb)\n}\n","export * from './Looper'\nexport * from './onFrame'\nexport * from './singleton'\n"]}